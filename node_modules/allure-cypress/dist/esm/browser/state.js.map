{"version":3,"file":"state.js","names":["DEFAULT_RUNTIME_CONFIG","last","toReversed","getAllureState","state","Cypress","env","config","initialized","messages","testPlan","undefined","currentTest","projectDir","stepStack","stepsToFinalize","nextApiStepId","isAllureInitialized","setAllureInitialized","getRuntimeMessages","setRuntimeMessages","value","enqueueRuntimeMessage","message","push","getAllureTestPlan","getProjectDir","getCurrentTest","setCurrentTest","test","dropCurrentTest","getConfig","getStepStack","getCurrentStep","pushStep","step","popStep","pop","popSteps","index","splice","popAllSteps","clearStepStack","setupStepFinalization","finalizer","getStepsToFinalize","clearStepsToFinalize"],"sources":["../../../src/browser/state.ts"],"sourcesContent":["import type { AllureSpecState, CypressMessage, CypressTest, StepDescriptor, StepFinalizer } from \"../types.js\";\nimport { DEFAULT_RUNTIME_CONFIG, last, toReversed } from \"../utils.js\";\n\nexport const getAllureState = () => {\n  let state = Cypress.env(\"allure\") as AllureSpecState;\n\n  if (!state) {\n    state = {\n      config: DEFAULT_RUNTIME_CONFIG,\n      initialized: false,\n      messages: [],\n      testPlan: undefined,\n      currentTest: undefined,\n      projectDir: undefined,\n      stepStack: [],\n      stepsToFinalize: [],\n      nextApiStepId: 0,\n    };\n\n    Cypress.env(\"allure\", state);\n  }\n\n  return state;\n};\n\nexport const isAllureInitialized = () => getAllureState().initialized;\n\nexport const setAllureInitialized = () => {\n  getAllureState().initialized = true;\n};\n\nexport const getRuntimeMessages = () => getAllureState().messages;\n\nexport const setRuntimeMessages = (value: CypressMessage[]) => {\n  getAllureState().messages = value;\n};\n\nexport const enqueueRuntimeMessage = (message: CypressMessage) => {\n  getRuntimeMessages().push(message);\n};\n\nexport const getAllureTestPlan = () => getAllureState().testPlan;\n\nexport const getProjectDir = () => getAllureState().projectDir;\n\nexport const getCurrentTest = () => getAllureState().currentTest;\n\nexport const setCurrentTest = (test: CypressTest) => {\n  getAllureState().currentTest = test;\n};\n\nexport const dropCurrentTest = () => {\n  getAllureState().currentTest = undefined;\n};\n\nexport const getConfig = () => getAllureState().config;\n\nexport const getStepStack = () => getAllureState().stepStack;\n\nexport const getCurrentStep = () => last(getStepStack());\n\nexport const pushStep = (step: StepDescriptor) => getStepStack().push(step);\n\nexport const popStep = () => getStepStack().pop();\n\nexport const popSteps = (index: number) => toReversed(getStepStack().splice(index));\n\nexport const popAllSteps = () => popSteps(0);\n\nexport const clearStepStack = () => {\n  getAllureState().stepStack = [];\n};\n\nexport const setupStepFinalization = <T extends StepDescriptor>(step: T, finalizer?: StepFinalizer) =>\n  getAllureState().stepsToFinalize.push([step, finalizer]);\n\nexport const getStepsToFinalize = () => getAllureState().stepsToFinalize;\n\nexport const clearStepsToFinalize = () => {\n  const state = getAllureState();\n  state.stepsToFinalize = [];\n};\n"],"mappings":"AACA,SAASA,sBAAsB,EAAEC,IAAI,EAAEC,UAAU,QAAQ,aAAa;AAEtE,OAAO,IAAMC,cAAc,GAAGA,CAAA,KAAM;EAClC,IAAIC,KAAK,GAAGC,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAoB;EAEpD,IAAI,CAACF,KAAK,EAAE;IACVA,KAAK,GAAG;MACNG,MAAM,EAAEP,sBAAsB;MAC9BQ,WAAW,EAAE,KAAK;MAClBC,QAAQ,EAAE,EAAE;MACZC,QAAQ,EAAEC,SAAS;MACnBC,WAAW,EAAED,SAAS;MACtBE,UAAU,EAAEF,SAAS;MACrBG,SAAS,EAAE,EAAE;MACbC,eAAe,EAAE,EAAE;MACnBC,aAAa,EAAE;IACjB,CAAC;IAEDX,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEF,KAAK,CAAC;EAC9B;EAEA,OAAOA,KAAK;AACd,CAAC;AAED,OAAO,IAAMa,mBAAmB,GAAGA,CAAA,KAAMd,cAAc,CAAC,CAAC,CAACK,WAAW;AAErE,OAAO,IAAMU,oBAAoB,GAAGA,CAAA,KAAM;EACxCf,cAAc,CAAC,CAAC,CAACK,WAAW,GAAG,IAAI;AACrC,CAAC;AAED,OAAO,IAAMW,kBAAkB,GAAGA,CAAA,KAAMhB,cAAc,CAAC,CAAC,CAACM,QAAQ;AAEjE,OAAO,IAAMW,kBAAkB,GAAIC,KAAuB,IAAK;EAC7DlB,cAAc,CAAC,CAAC,CAACM,QAAQ,GAAGY,KAAK;AACnC,CAAC;AAED,OAAO,IAAMC,qBAAqB,GAAIC,OAAuB,IAAK;EAChEJ,kBAAkB,CAAC,CAAC,CAACK,IAAI,CAACD,OAAO,CAAC;AACpC,CAAC;AAED,OAAO,IAAME,iBAAiB,GAAGA,CAAA,KAAMtB,cAAc,CAAC,CAAC,CAACO,QAAQ;AAEhE,OAAO,IAAMgB,aAAa,GAAGA,CAAA,KAAMvB,cAAc,CAAC,CAAC,CAACU,UAAU;AAE9D,OAAO,IAAMc,cAAc,GAAGA,CAAA,KAAMxB,cAAc,CAAC,CAAC,CAACS,WAAW;AAEhE,OAAO,IAAMgB,cAAc,GAAIC,IAAiB,IAAK;EACnD1B,cAAc,CAAC,CAAC,CAACS,WAAW,GAAGiB,IAAI;AACrC,CAAC;AAED,OAAO,IAAMC,eAAe,GAAGA,CAAA,KAAM;EACnC3B,cAAc,CAAC,CAAC,CAACS,WAAW,GAAGD,SAAS;AAC1C,CAAC;AAED,OAAO,IAAMoB,SAAS,GAAGA,CAAA,KAAM5B,cAAc,CAAC,CAAC,CAACI,MAAM;AAEtD,OAAO,IAAMyB,YAAY,GAAGA,CAAA,KAAM7B,cAAc,CAAC,CAAC,CAACW,SAAS;AAE5D,OAAO,IAAMmB,cAAc,GAAGA,CAAA,KAAMhC,IAAI,CAAC+B,YAAY,CAAC,CAAC,CAAC;AAExD,OAAO,IAAME,QAAQ,GAAIC,IAAoB,IAAKH,YAAY,CAAC,CAAC,CAACR,IAAI,CAACW,IAAI,CAAC;AAE3E,OAAO,IAAMC,OAAO,GAAGA,CAAA,KAAMJ,YAAY,CAAC,CAAC,CAACK,GAAG,CAAC,CAAC;AAEjD,OAAO,IAAMC,QAAQ,GAAIC,KAAa,IAAKrC,UAAU,CAAC8B,YAAY,CAAC,CAAC,CAACQ,MAAM,CAACD,KAAK,CAAC,CAAC;AAEnF,OAAO,IAAME,WAAW,GAAGA,CAAA,KAAMH,QAAQ,CAAC,CAAC,CAAC;AAE5C,OAAO,IAAMI,cAAc,GAAGA,CAAA,KAAM;EAClCvC,cAAc,CAAC,CAAC,CAACW,SAAS,GAAG,EAAE;AACjC,CAAC;AAED,OAAO,IAAM6B,qBAAqB,GAAGA,CAA2BR,IAAO,EAAES,SAAyB,KAChGzC,cAAc,CAAC,CAAC,CAACY,eAAe,CAACS,IAAI,CAAC,CAACW,IAAI,EAAES,SAAS,CAAC,CAAC;AAE1D,OAAO,IAAMC,kBAAkB,GAAGA,CAAA,KAAM1C,cAAc,CAAC,CAAC,CAACY,eAAe;AAExE,OAAO,IAAM+B,oBAAoB,GAAGA,CAAA,KAAM;EACxC,IAAM1C,KAAK,GAAGD,cAAc,CAAC,CAAC;EAC9BC,KAAK,CAACW,eAAe,GAAG,EAAE;AAC5B,CAAC","ignoreList":[]}