{"version":3,"file":"cypress.js","names":["setupScreenshotAttachmentStep","shouldCreateStepFromCommandLogEntry","startCommandLogStep","reportScreenshot","reportStepError","getFileNameFromPath","registerCypressEventListeners","Cypress","on","onFail","onLogAdded","enableReportingOfCypressScreenshots","Screenshot","defaults","onAfterScreenshot","_len","arguments","length","_ref","Array","_key","name","originalName","path","_","entry","error","noSubsequentFailListeners","Object","is","listeners","at"],"sources":["../../../../src/browser/events/cypress.ts"],"sourcesContent":["import type { CypressLogEntry } from \"../../types.js\";\nimport {\n  setupScreenshotAttachmentStep,\n  shouldCreateStepFromCommandLogEntry,\n  startCommandLogStep,\n} from \"../commandLog.js\";\nimport { reportScreenshot } from \"../lifecycle.js\";\nimport { reportStepError } from \"../steps.js\";\nimport { getFileNameFromPath } from \"../utils.js\";\n\nexport const registerCypressEventListeners = () => Cypress.on(\"fail\", onFail).on(\"log:added\", onLogAdded);\n\nexport const enableReportingOfCypressScreenshots = () => Cypress.Screenshot.defaults({ onAfterScreenshot });\n\nconst onAfterScreenshot = (\n  ...[, { name: originalName, path }]: Parameters<Cypress.ScreenshotDefaultsOptions[\"onAfterScreenshot\"]>\n) => {\n  const name = originalName ?? getFileNameFromPath(path);\n\n  reportScreenshot(path, name);\n  setupScreenshotAttachmentStep(originalName, name);\n};\n\nconst onLogAdded = (_: Cypress.ObjectLike, entry: CypressLogEntry) => {\n  if (shouldCreateStepFromCommandLogEntry(entry)) {\n    startCommandLogStep(entry);\n  }\n};\n\nconst onFail = (error: Cypress.CypressError) => {\n  reportStepError(error);\n\n  // If there are more \"fail\" handlers yet to run, it's not our responsibility to throw.\n  // Otherwise, we won't give them any chance to do their job (EventEmitter stops executing handlers as soon\n  // as one of them throws - that is also true for eventemitter2, which is used by the browser-side of Cypress).\n  if (noSubsequentFailListeners()) {\n    throw error;\n  }\n};\n\nconst noSubsequentFailListeners = () => Object.is(Cypress.listeners(\"fail\").at(-1), onFail);\n"],"mappings":"AACA,SACEA,6BAA6B,EAC7BC,mCAAmC,EACnCC,mBAAmB,QACd,kBAAkB;AACzB,SAASC,gBAAgB,QAAQ,iBAAiB;AAClD,SAASC,eAAe,QAAQ,aAAa;AAC7C,SAASC,mBAAmB,QAAQ,aAAa;AAEjD,OAAO,IAAMC,6BAA6B,GAAGA,CAAA,KAAMC,OAAO,CAACC,EAAE,CAAC,MAAM,EAAEC,MAAM,CAAC,CAACD,EAAE,CAAC,WAAW,EAAEE,UAAU,CAAC;AAEzG,OAAO,IAAMC,mCAAmC,GAAGA,CAAA,KAAMJ,OAAO,CAACK,UAAU,CAACC,QAAQ,CAAC;EAAEC;AAAkB,CAAC,CAAC;AAE3G,IAAMA,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAA,EAElB;EAAA,SAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAC,IAAA,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;IAAAF,IAAA,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;EAAA;EAAA,IADA,GAAG;IAAEC,IAAI,EAAEC,YAAY;IAAEC;EAAK,CAAC,CAAC,GAAAL,IAAA;EAEnC,IAAMG,IAAI,GAAGC,YAAY,aAAZA,YAAY,cAAZA,YAAY,GAAIjB,mBAAmB,CAACkB,IAAI,CAAC;EAEtDpB,gBAAgB,CAACoB,IAAI,EAAEF,IAAI,CAAC;EAC5BrB,6BAA6B,CAACsB,YAAY,EAAED,IAAI,CAAC;AACnD,CAAC;AAED,IAAMX,UAAU,GAAGA,CAACc,CAAqB,EAAEC,KAAsB,KAAK;EACpE,IAAIxB,mCAAmC,CAACwB,KAAK,CAAC,EAAE;IAC9CvB,mBAAmB,CAACuB,KAAK,CAAC;EAC5B;AACF,CAAC;AAED,IAAMhB,MAAM,GAAIiB,KAA2B,IAAK;EAC9CtB,eAAe,CAACsB,KAAK,CAAC;;EAEtB;EACA;EACA;EACA,IAAIC,yBAAyB,CAAC,CAAC,EAAE;IAC/B,MAAMD,KAAK;EACb;AACF,CAAC;AAED,IAAMC,yBAAyB,GAAGA,CAAA,KAAMC,MAAM,CAACC,EAAE,CAACtB,OAAO,CAACuB,SAAS,CAAC,MAAM,CAAC,CAACC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAEtB,MAAM,CAAC","ignoreList":[]}